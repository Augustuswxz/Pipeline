# 智能对齐智能体

## 环境配置

### Python环境

```
conda create -n pipeline python=3.12
conda activate pipeline
pip install -r requirements.txt
```

### Ollama配置

```
ollama pull qwen2.5:14b
ollama serve
```

## 启动项目

```
streamlit run .\main.py
```

自动打开网页端

## 知识库配置

智能体为数据对齐功能添加了知识库

知识库中存储这表格表头的标准名以及对应的诸多别名

用户可以根据需要查看并修改知识库

### 查看知识库

在对话栏输入`“查看知识库”`以查看现有条目

### 添加标准名

在对话栏输入`“修改知识库，添加标准名“A”，并关联别名“B”、“C””`以添加新的标准名同时关联别名

### 添加别名

在对话栏输入`“修改知识库，在标准名“A”下关联别名“D””`以在已有的标准名下关联新别名

### 删除别名

在对话栏输入`“修改知识库，删除标准名“A”下的别名“B””`以在已有的标准名下删除已有的别名

### 删除标准名

## 数据清洗

点击左侧边栏“数据清洗”栏

点击上传需要清洗的表格

在对话栏输入`“清洗上传的文件”`开始数据清洗

清洗结束后前端页面生成下载链接，点击下载清洗后的文件

## 数据对齐

将需要对齐的两份表格清洗完成后

点击侧栏“数据对齐”栏

将两份表格分别上传到两个上传框

在对话栏输入`“对齐这两份不同来源的表格”`进行数据对齐

智能体中设置了固定的阈值，会先按此阈值生成一份对齐结果

此外，智能体还会根据上传文件的统计数据从对齐记忆库中寻找是否有分布接近的对齐记录

如果有，则尝试从记录中读取专家意见，依据意见中设置的阈值生成第二份结果供用户比较

用户需要输入`“A”`或`“B”`来选择保存的方案，`“A”`为默认计算结果；`“B”`为相似记录专家意见结果

如果没有，则直接只展示默认设置对齐结果并存储记录

存储结果后，智能体会询问是否要为此记录添加专家意见

如果想要添加专家意见，输入`“ 添加专家修正意见，阈值改为[距离, 时钟方位, 长度, 宽度, 深度]，因为...”`

例如`“添加专家修正意见，将阈值改为[1.3, 48, 13, 13, 5]，因为深度太浅不利于对齐”`

智能体会自动提取新阈值并重新生成结果供用户查看比较

用户可多次按照上述格式使用新阈值生成结果，直至满意

智能体会保存最后一次专家意见 

若用户不想添加专家意见或是已添加满意的专家意见，可以输入`“不用”`以结束对齐

## 短期记忆

在**同一轮对话**中，智能体会记忆用户上传的清洗文件以及对齐文件

如果用户想要再次清洗或对齐，在输入中提到`"重新清洗`"或`"重新对齐"`即可，不必输入文件名称

## 开启新对话

在侧栏点击“开启新对话”按钮以开启新一轮对话

智能体会**清除上述短期记忆**

用户需要重新上传文件